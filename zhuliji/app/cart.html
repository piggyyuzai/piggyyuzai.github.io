<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <title>注礼记</title>
  <link rel="shortcut icon" href="./image/zhuliji.jpg">
  <link rel="apple-touch-icon" href="./image/zhuliji.jpg">
  <link rel="stylesheet" href="./common.css">
  <link rel="stylesheet" href="./cart.css">
  <script src="./common.js"></script>
</head>
<body>
<!-- 顶部导航栏 -->
<div class="top-bar">
  <div class="back-button" onclick="javascript:history.back()">
    <img src="./image/back.png" alt="返回">
  </div>
  <div>购物车</div>
</div>

<!-- 中间内容区 -->
<div class="container">
  <div class="cart-box">
    <div class="cart-list" data-index="0">
      <input type="checkbox" class="cart-pro-select" onchange="selectList(this)">
      <img class="cart-thumb" src="./image/g1.jpg">
      <div class="cart-pro-info">
        <div class="cart-pro-name">粽横四海礼盒</div>
        <div class="cart-pro-price">98￥</div>
        <div class="cart-count-box">
          <div class="cart-count-down" onclick="minusCount(this)">-</div>
          <div class="cart-count-num">1</div>
          <div class="cart-count-add" onclick="addCount(this)">+</div>
        </div>
        <div class="cart-del" onclick="deleteList(this)">×</div>
      </div>
    </div>
    <div class="cart-list" data-index="1">
      <input type="checkbox" class="cart-pro-select" onchange="selectList(this)" checked>
      <img class="cart-thumb" src="./image/g4.jpg">
      <div class="cart-pro-info">
        <div class="cart-pro-name">盲盒喜糖</div>
        <div class="cart-pro-price">18￥</div>
        <div class="cart-count-box">
          <div class="cart-count-down" onclick="minusCount(this)">-</div>
          <div class="cart-count-num">4</div>
          <div class="cart-count-add" onclick="addCount(this)">+</div>
        </div>
        <div class="cart-del" onclick="deleteList(this)">×</div>
      </div>
    </div>
  </div>
  <label class="custom-checkbox">
    <input type="checkbox">
    <span class="checkmark"></span>
    文字描述
  </label>
  <div class="cart-footer">
    <input type="checkbox" class="total-select" onclick="selectAll(this)">
    <div>全选</div>
    <div class="cart-toatl-price">￥0</div>
  </div>
</div>
<!-- 底部选项卡 -->
<div class="tab-bar">
  <a href="./index.html" class="tab-item">
    <img src="./image/11.png" alt="home">
    <span>首页</span>
  </a>
  <a href="./cate.html" class="tab-item">
    <img src="./image/21.png" alt="cate">
    <span>分类</span>
  </a>
  <a href="./cart.html" class="tab-item active">
    <img src="./image/32.png" alt="cart">
    <span>购物车</span>
  </a>
  <a href="./user.html" class="tab-item">
    <img src="./image/41.png" alt="user">
    <span>我的</span>
  </a>
</div>
</body>
<script>
  window.onload = function() {
    getTotalPrice();
  };
  let carts = document.querySelectorAll('.cart-list');

  function selectAll(checkbox) {
    let checked = checkbox.checked;
    for (let i = 0; i < carts.length; i++) {
      let cart = carts[i];
      cart.querySelector('.cart-pro-select').checked = checked;
    }
    getTotalPrice();
  }

  function selectList(checkbox) {
    getTotalPrice();
  }

  function addCount(button) {
    let countElement = button.previousElementSibling;
    let count = parseInt(countElement.textContent);
    count++;
    countElement.textContent = count;
    getTotalPrice();
  }

  function minusCount(button) {
    let countElement = button.nextElementSibling;
    let count = parseInt(countElement.textContent);
    if (count > 1) {
      count--;
      countElement.textContent = count;
      getTotalPrice();
    }
  }

  function deleteList(button) {
    let cartList = button.parentElement.parentElement;
    cartList.remove();
    if (document.querySelectorAll('.cart-list').length === 0) {
      document.querySelector('.container').innerHTML = '<div style="text-align:center;color:#888;margin-top:20px;">购物车为空~</div>';
    }
    getTotalPrice();
  }

  function getTotalPrice() {
    let totalPrice = 0;
    let allSelected = true; // 假设所有商品都被选中

    for (let i = 0; i < carts.length; i++) {
      let cart = carts[i];
      if (cart.querySelector('.cart-pro-select').checked) {
        let price = parseFloat(cart.querySelector('.cart-pro-price').textContent);
        let count = parseInt(cart.querySelector('.cart-count-num').textContent);
        totalPrice += price * count;
      } else {
        allSelected = false; // 只要有一个商品未被选中，则不是全部选中状态
      }
    }

    document.querySelector('.cart-toatl-price').textContent = '￥' + totalPrice.toFixed(0);

    // 更新全选按钮状态
    document.querySelector('.total-select').checked = allSelected;
  }
</script>
</html>
